## ä»€ä¹ˆæ˜¯PBR

PBRçš„å…¨ç§°æ˜¯Physically-Based Renderingï¼Œå‡†ç¡®åœ°è¯´ï¼ŒPBRå…¶å®åŒ…æ‹¬å¤šä¸ªæ–¹é¢ï¼Œæ¯”å¦‚ç¯å…‰ã€æè´¨ã€ç€è‰²ç­‰ã€‚**æˆ‘ä»¬å¹³æ—¶è¯´çš„PBRï¼Œä»€ä¹ˆæ¸²æŸ“æ–¹ç¨‹ã€BRDFä¹‹ç±»çš„ï¼ŒæŒ‡çš„æ˜¯PBRçš„ç€è‰²éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯PBSï¼Œå…¨ç§°æ˜¯Physically-Based Shading

> æˆ‘ä»¬ç†ŸçŸ¥çš„Lambertã€Phongç­‰ç®—æ³•ï¼Œå°±æ˜¯å…‰ç…§ç€è‰²ç®—æ³•ï¼ˆShading = ç€è‰²ï¼ŒShader = ç€è‰²å™¨ï¼‰ã€‚PBRå¹¶ä¸æ˜¯æŸä¸€ç§ç‰¹æŒ‡çš„ç®—æ³•ï¼Œè€Œæ˜¯ä¸€ç±»ç®—æ³•çš„ç»Ÿç§°ã€‚åªè¦ä¸€ç§ç€è‰²ç®—æ³•æ»¡è¶³ä¸€å®šçš„ç‰©ç†è§„å¾‹ï¼ˆèƒ½é‡å®ˆæ’ç­‰ï¼‰ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºå®ƒå±äºPBRç®—æ³•ï¼Œåä¹‹ï¼Œåˆ™ä¸å±äºPBRç®—æ³•ã€‚

PBRçš„ä½œç”¨ï¼šæ¯”èµ·åœ¨ä¼ ç»Ÿç»éªŒç®—æ³•ä¸­åŠ å…¥ä¸€äº›ç»éªŒæ§åˆ¶å‚æ•°æ¥æ§åˆ¶é«˜å…‰ã€æ¼«åå°„ç­‰æ•ˆæœï¼ŒPBRç®—æ³•ä¸­é€šå¸¸ä¼šæä¾›**ç²—ç³™åº¦ã€é‡‘å±åº¦ã€åå°„ç‡ç­‰å…·æœ‰ç‰©ç†æ„ä¹‰çš„æè´¨å‚æ•°**æ¥æ§åˆ¶æ¸²æŸ“æ•ˆæœï¼Œè€Œä¸”ä¸åŒæè´¨çš„è¿™äº›å‚æ•°ï¼Œå¯ä»¥é€šè¿‡ç›´æ¥åœ¨ç°å®ä¸­æµ‹é‡è·å¾—

## å…‰è¾å°„ç†è®ºåŸºç¡€

PBRç®—æ³•æˆç«‹çš„åŸºç¡€ï¼Œå°±æ˜¯æ‰€è°“çš„**æ¸²æŸ“æ–¹ç¨‹ï¼ˆRendering Equationï¼‰**

$L_0(x,w)=L_e(x,w)+\int{\Omega}f_r(x,w,w_i)L_i(x,w_i)\cos(w_i,n)dw_i$ 

å‡ ä¸ªå…³äºå…‰çš„ç‰©ç†æ¦‚å¿µï¼š

**è¾å°„èƒ½é‡ï¼ˆRadiant Energyï¼‰ï¼š**å…‰ä»¥ç”µç£æ³¢æˆ–è€…ç²’å­çš„å½¢å¼ç§»åŠ¨æ—¶ä¼šæºå¸¦èƒ½é‡ï¼Œè¿™ä¸ªèƒ½é‡è¢«ç§°ä¸ºè¾å°„èƒ½é‡ï¼Œå•ä½è‡ªç„¶æ˜¯**ç„¦è€³(J)**ã€‚

**è¾å°„é€šé‡ï¼ˆRadiant Fluxï¼‰ï¼š**è¾å°„é€šé‡çš„ç‰©ç†æ„ä¹‰æ˜¯**å•ä½æ—¶é—´å†…ï¼ŒæŸä¸€åŒºåŸŸé€šè¿‡çš„è¾å°„èƒ½é‡**ï¼Œå¯ä»¥ç†è§£ä¸ºè¾å°„èƒ½é‡å¯¹æ—¶é—´çš„å¾®åˆ†ï¼Œä¹Ÿå°±æ˜¯åŠŸç‡ã€‚è¾å°„é€šé‡çš„å•ä½æ˜¯**æµæ˜(lm)**ï¼Œä½†è·Ÿæˆ‘ä»¬ç†Ÿæ‚‰çš„ç“¦ç‰¹æ˜¯ç­‰æ•ˆçš„ã€‚å›½é™…å•ä½åˆ¶ä¸­å®šä¹‰æ³¢é•¿ä¸º555nmçš„å•è‰²å…‰å‘å‡ºçš„è¾å°„é€šé‡1W=683lmã€‚

**è¾å°„ç…§åº¦ï¼ˆIrradianceï¼‰ï¼š**è¾å°„ç…§åº¦çš„ç‰©ç†æ„ä¹‰æ˜¯**å•ä½æ—¶é—´å†…ï¼Œå•ä½é¢ç§¯ä¸Šå¸æ”¶çš„è¾å°„èƒ½é‡**ã€‚å½“ç„¶ï¼Œæ–¹å‘å…‰ä¸ä¼šç…§å‘èƒŒé¢ï¼Œåªæœ‰è¡¨é¢æ³•çº¿åŠçƒå†…å…¥å°„çš„å…‰çº¿æ‰ä¼šå¯¹è¾å°„ç…§åº¦æœ‰è´¡çŒ®ã€‚è¾å°„ç…§åº¦çš„å•ä½æ˜¯**å‹’å…‹æ–¯(lux)**ï¼Œ$lux = \frac {lm} {{m}^{2}}$Â ï¼Œç›¸å½“äº$\frac {W} {{m}^{2}}$ã€‚

**è¾å°„äº®åº¦ï¼ˆRadianceï¼‰ï¼š**è¾å°„äº®åº¦ç‰©ç†æ„ä¹‰æ˜¯**å•ä½æ—¶é—´å†…ï¼Œå•ä½ç«‹ä½“è§’æ–¹å‘ä¸Šï¼Œå•ä½é¢ç§¯ä¸Šå‘å‡º/æ¥å—çš„è¾å°„èƒ½é‡ã€‚**è¾å°„äº®åº¦çš„å•ä½æ˜¯**å°¼ç‰¹(nit)**ï¼Œå°±æ‰‹æœºå±å¹•äº®åº¦é‚£ä¸ªå°¼ç‰¹ï¼Œ$nit = \frac {lm} {sr * {m}^{2}}$Â ï¼Œç›¸å½“äºÂ $\frac {W} {sr * {m}^{2}}$Â ã€‚è¿™ä¸ªsrå‘¢ï¼Œæ˜¯ç«‹ä½“è§’çš„å•ä½**çƒé¢åº¦**ï¼Œå¯ä»¥ç†è§£ä¸ºä¸‰ç»´çš„å¼§åº¦ï¼Œè¡¨ç¤ºå•ä½çƒä½“ä¸Šçš„ä¸€å—é¢ç§¯ã€‚

é¡ºå¸¦ä¸€æï¼ŒÂ $\frac {lm} {sr}$Â è¿™ä¸ªå•ä½å«**åå¾·æ‹‰(cd)**ï¼Œæ˜¯ä¸ƒç§å›½é™…åŸºæœ¬å•ä½ä¹‹ä¸€ï¼Œç”¨äºè¡¨ç¤º**å‘å…‰å¼ºåº¦/è¾å°„å¼ºåº¦ï¼ˆRadiant Intensityï¼‰**

æ€»ç»“
- è¾å°„èƒ½é‡æ˜¯å…‰çš„èƒ½é‡ã€‚
- è¾å°„é€šé‡æ˜¯å…‰çš„åŠŸç‡ã€‚
- å‘å…‰å¼ºåº¦/è¾å°„å¼ºåº¦æ˜¯é’ˆå¯¹**å…‰æº**çš„å•ä½ï¼Œè¡¨ç¤ºç‰©ä½“å‘æŸä¸€æ–¹å‘**å‘å…‰**çš„åŠŸç‡ã€‚ç‰¹åˆ«çš„ï¼Œå› ä¸ºä¸æ¶‰åŠé¢ç§¯ï¼Œæ‰€ä»¥é€šå¸¸ç”¨æ¥æè¿°ç‚¹å…‰æº
- Irradianceæ˜¯é’ˆå¯¹**å—å…‰ç‰©**çš„å•ä½ï¼Œè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªå•ä½é¢ç§¯ä¸Šè¢«å…‰ç…§å°„å**å¸æ”¶**çš„åŠŸç‡ã€‚
- Radianceæ˜¯åŒæ—¶ç”¨äº**å…‰æº/å—å…‰ç‰©**çš„å•ä½ï¼Œç”¨äºå…‰æºæ—¶ï¼Œè¡¨ç¤ºå•ä½é¢ç§¯å…‰æºå‘æŸä¸€æ–¹å‘**å‘å…‰**çš„åŠŸç‡ï¼Œç”¨äºå—å…‰ç‰©æ—¶ï¼Œåˆ™è¡¨ç¤ºå•ä½é¢ç§¯ç‰©ä½“ä»æŸä¸€æ–¹å‘å…‰**æ¥å—**åˆ°çš„åŠŸç‡ã€‚Radianceé€šå¸¸è¢«ç”¨æ¥æè¿°é¢å…‰æºï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ‰‹æœºå±å¹•ã€æ˜¾ç¤ºå™¨çš„äº®åº¦å•ä½éƒ½æ˜¯Radianceã€‚
- ä¸Šè¿°ç‰©ç†é‡çš†ä¸ºçº¿æ€§ï¼Œå¯ä»¥æ‹†åˆ†ã€åŠ å‡ã€‚

## è¾å°„

è¾å°„é€šé‡çš„å®Œæ•´å®šä¹‰æ˜¯ï¼Œå•ä½æ—¶é—´å†…ï¼Œé€šè¿‡æŸä¸€åŒºåŸŸçš„**æœ‰æ•ˆ**è¾å°„èƒ½é‡
åœ¨å…‰çº¿å‚ç›´å…¥å°„çš„æƒ…å†µä¸‹ï¼Œæœ‰æ•ˆèƒ½é‡å°±ç­‰äºå…¥å°„èƒ½é‡ï¼Œè€Œå…‰çº¿ä¸å¹³é¢ä¸å‚ç›´çš„æƒ…å†µä¸‹ï¼Œä¹˜ä»¥æ³•çº¿å¤¹è§’ä½™å¼¦åæ‰æ˜¯æœ‰æ•ˆçš„èƒ½é‡

æˆ‘ä»¬ç”¨Î¦Â è¡¨ç¤ºåˆ°è¾¾ç‰©ä½“çš„æœ‰æ•ˆè¾å°„é€šé‡ï¼ŒÂ Î¦0Â è¡¨ç¤ºåŸå§‹çš„è¾å°„é€šé‡ï¼ŒÂ ğœƒÂ è¡¨ç¤ºæ³•çº¿ä¸å…‰æºæ–¹å‘å¤¹è§’ï¼Œåˆ™æœ‰ï¼š

$\Phi={\Phi}_{0}*cos\theta$

ç„¶åæˆ‘ä»¬å†æ¥çœ‹çœ‹Irradianceï¼Œå…¶å®šä¹‰æ˜¯è¾å°„é€šé‡å¯¹é¢ç§¯çš„å¾®åˆ†ï¼Œå®é™…å«ä¹‰ä¸ºå•ä½æ—¶é—´å†…ï¼Œåˆ°è¾¾å•ä½é¢ç§¯çš„æœ‰æ•ˆè¾å°„èƒ½é‡ã€‚æˆ‘ä»¬ç”¨Â ğ‘‘ğ´Â è¡¨ç¤ºå•ä½é¢ç§¯ï¼Œğ¸Â è¡¨ç¤ºIrradianceï¼Œåˆ™æœ‰ï¼š

$E=\frac{d\Phi} {dA}=\frac {d{\Phi}_{0}*cos\theta} {dA}$

é€šä¿—çš„ç†è§£å°±æ˜¯**ç…§å°„åˆ°æŸä¸€ç‚¹çš„æœ‰æ•ˆåŠŸç‡**

é‡ç‚¹åœ¨Radianceçš„å®šä¹‰å¼åªæœ‰ä¸€ä¸ªï¼Œæˆ‘ä»¬ç”¨Â ğ‘‘ğœ”Â è¡¨ç¤ºå•ä½ç«‹ä½“è§’ï¼ŒÂ ğ¿Â è¡¨ç¤ºRadianceï¼Œæœ‰ï¼š

$L=\frac{d^2\Phi} {dA * dA * dw * cos\theta }=\frac {d^2\Phi_0*cos\theta} {dA*dw*cos\theta} =\frac{d^2\Phi_0} {dAdw}$

æ³¨æ„åˆ†æ¯ä¸­çš„Â ğ‘ğ‘œğ‘ ğœƒÂ ï¼Œæˆ‘ä»¬æ—¢å¯ä»¥å°†å…¶ç†è§£ä¸ºÂ ğ‘‘ğ´ğ‘ğ‘œğ‘ ğœƒÂ ï¼ˆå•ä½æŠ•å½±é¢ç§¯ï¼‰ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºÂ ğ‘‘ğœ”ğ‘ğ‘œğ‘ ğœƒÂ ï¼ˆå•ä½æŠ•å½±ç«‹ä½“è§’ï¼‰

æ€»ç»“ä¸€ä¸‹ï¼ŒRadianceçš„å®é™…å«ä¹‰æ˜¯ï¼Œå•ä½æ—¶é—´å†…ï¼Œå•ä½æŠ•å½±ç«‹ä½“è§’æ–¹å‘ï¼Œå•ä½é¢ç§¯ä¸Šå‘å‡º/æ¥å—çš„æœ‰æ•ˆè¾å°„èƒ½é‡ï¼Œæˆ–æ˜¯å•ä½æ—¶é—´å†…ï¼Œå•ä½ç«‹ä½“è§’æ–¹å‘ï¼Œå•ä½æŠ•å½±é¢ç§¯ä¸Šå‘å‡º/æ¥å—çš„æœ‰æ•ˆè¾å°„èƒ½é‡ã€‚æ¢æˆå¤§ç™½è¯è¯´ï¼Œ**ç‚¹å…‰æºå‘æŸä¸€æ–¹å‘å‘å‡ºçš„åŠŸç‡ï¼Œæˆ–æ˜¯ä»æŸä¸€æ–¹å‘ç…§å°„åˆ°æŸä¸€ç‚¹çš„åŠŸç‡ï¼ˆæ³¨æ„ä¸æ˜¯æœ‰æ•ˆåŠŸç‡ï¼‰ã€‚**

æœ€åï¼Œç»“åˆä¸Šé¢ä¸¤å¼ï¼Œå¯å¾—Â ğ¸=âˆ«ğ¿âˆ—ğ‘ğ‘œğ‘ ğœƒğ‘‘ğœ”Â ï¼Œè¿™ä¸ªå¼å­æˆ‘ä»¬åé¢ä¼šç»å¸¸ç”¨åˆ°ã€‚

## ç†è§£æ¸²æŸ“æ–¹ç¨‹

äººçœ¼çœ‹åˆ°çš„é¢œè‰²å³æ˜¯äº®åº¦Radianceï¼Œè¿™ä¸ªRadianceæ—¢å¯ä»¥ç›´æ¥ç”±å…‰æºå‘å‡ºï¼Œä¹Ÿå¯ä»¥ç”±ç‰©ä½“åå°„å‘å‡ºã€‚å„ç§ç›´æ¥å’Œé—´æ¥å…‰æºå‘ç‰©ä½“è¡¨é¢å‘å‡ºRadianceï¼Œå…¨éƒ¨åˆ°è¾¾ç‰©ä½“è¡¨é¢åè¢«å¸æ”¶ä¸ºIrradianceï¼Œéšåç‰©ä½“ä½œä¸ºåå°„å…‰æºå‘è§‚å¯Ÿæ–¹å‘å‘å‡ºRadianceåˆ°è¾¾äººçœ¼ï¼Œæœ€ç»ˆå½¢æˆè¢«çœ‹åˆ°çš„é¢œè‰²ã€‚

æ¸²æŸ“æ–¹ç¨‹å°±æ˜¯å¯¹ä¸Šè¿°è¿‡ç¨‹çš„æŠ½è±¡ï¼Œæ¥çœ‹å¼å­ï¼š

$L_0(x,w)=L_e(x,w)+\int{\Omega}f_r(x,w,w_i)L_i(x,w_i)cos(w_i,n)dw_i$ 

$L_0(x,w)$ä»£è¡¨åæ ‡xå¤„å‘å°„åˆ°è§‚å¯Ÿæ–¹å‘væ‰€å¯¹åº”çš„å•ä½ç«‹ä½“è§’Â ğœ”Â çš„Radianceï¼Œå³æœ€ç»ˆè¢«æˆ‘ä»¬çœ‹åˆ°çš„é¢œè‰²ã€‚

$L_e(x,w)$Â ä»£è¡¨åæ ‡xå¤„è‡ªå‘å…‰ï¼ˆEmissionï¼‰çš„å‡ºå°„Radianceï¼Œä¸è¿‡å¾ˆå°‘æœ‰æè´¨ä¼šè‡ªå‘å…‰ï¼Œå› æ­¤è¿™ä¸€é¡¹é€šå¸¸æ˜¯å¿½ç•¥çš„ã€‚

å‰©ä¸‹çš„å¼å­åˆå«**åå°„ç‡æ–¹ç¨‹**ï¼Œè¡¨ç¤ºäº†ç‰©ä½“è¡¨é¢çš„å…¥å°„Irradianceå’Œå‡ºå°„Radianceä¹‹é—´çš„å…³ç³»ã€‚

$L_0(x,w)=\int{\Omega}f_r(x,w,w_i)L_i(x,w_i)cos(w_i,n)dw_i$

å…¶ä¸­ï¼š

$L_i(x,w_i)$Â æ˜¯ä»Â ğœ”ğ‘–æ–¹å‘å…¥å°„çš„Radianceï¼ŒÂ $cos (w_i,n)$Â æ˜¯å…¥å°„æ–¹å‘ä¸æ³•çº¿æ–¹å‘çš„å¤¹è§’ã€‚

å‰©ä¸‹çš„Â ğ‘“ğ‘Ÿ(ğ‘¥,ğœ”,ğœ”ğ‘–)Â è¿™ä¸€é¡¹ï¼Œå…¨åå«**åŒå‘åå°„åˆ†å¸ƒå‡½æ•°ï¼ˆBidirectional Reflectance Distribution Functionï¼ŒBRDFï¼‰ã€‚**BRDFæ˜¯å¯¹ä¸€ç±»å‡½æ•°çš„ç»Ÿç§°ï¼ŒLambertã€Phongã€Blinn-Phongç­‰æ¨¡å‹éƒ½æœ‰è‡ªå·±çš„BRDFã€‚

## ç†è§£BRDF

BRDFçš„å®šä¹‰å¼å¦‚ä¸‹ï¼š

$f_r(x,w,w_i) =\frac {L_0(x,w)} {L_i(x,w_i)cos(w_i,n)dw_i}$

å…¶å…·ä½“å®šä¹‰ä¸ºï¼Œç‰©ä½“è¡¨é¢å…¥å°„çš„Irradianceä¸­ï¼Œæ¥è‡ªå…¥å°„æ–¹å‘Â ğœ”ğ‘–Â çš„éƒ¨åˆ†ï¼Œæœ‰å¤šå°‘ä¼šè´¡çŒ®åˆ°å‘Â ğœ”Â æ–¹å‘å‡ºå°„çš„Radianceä¸­ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œé‚£å°±æ˜¯è¿™ä¸ªå¼å­çš„åˆ†æ¯çš„ç‰©ç†æ„ä¹‰æ˜¯**Irradianceä¸­ç”±**Â ğœ”ğ‘–Â **æ–¹å‘Radianceè´¡çŒ®çš„éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯Radianceã€‚**

ä¸ºäº†æ–¹ä¾¿æµ‹é‡ï¼Œäººä»¬å°±æŠŠBRDFçš„åˆ†æ¯é¡¹å®šä¹‰ä¸ºIrradianceäº†ã€‚å®šä¹‰å¼ä¸­ä¸Šæ–¹çš„å•ä½æ˜¯nitï¼Œä¸‹æ–¹çš„å•ä½æ˜¯luxï¼Œä¸¤è€…ä¸€é™¤ï¼Œæœ€åå•ä½æ˜¯Â $\frac{1} {ğ‘ ğ‘Ÿ}$Â ã€‚æ”¾å›åå°„ç‡æ–¹ç¨‹ä¹‹åï¼Œå¯ä»¥ä¿è¯ç§¯åˆ†ä¹‹åçš„å•ä½æ˜¯nitï¼Œæ˜¯ä¸€ä¸ªRadianceã€‚

BRDFæ—¢æœ‰ç‰©ç†çš„ä¹Ÿæœ‰éç‰©ç†çš„ï¼ŒPBRæ—¢ç„¶åŸºäºç‰©ç†ï¼Œé‚£è‚¯å®šè¦ä½¿ç”¨åŸºäºç‰©ç†çš„BRDFã€‚åªæœ‰æ»¡è¶³ä»¥ä¸‹ä¸€äº›ç‰©ç†åŸåˆ™çš„çš„BRDFï¼Œæ‰è¢«è®¤ä¸ºæ˜¯åŸºäºç‰©ç†çš„BRDFï¼š

- éè´Ÿæ€§ï¼šÂ ${f}_{r}(x,w,{w}_{i})>=0$
- å¯é€†æ€§ï¼šÂ ${f}_{r}(x,w,w_i)={f}_{r}(x,w_i,w)$ï¼Œå³è°ƒæ¢å…¥å°„å’Œå‡ºå°„æ–¹å‘ï¼Œç»“æœç›¸åŒ
- çº¿æ€§æ€§ï¼šå¯ä»¥å°†å…¥å°„Radianceæ‹†åˆ†ï¼Œåˆ†åˆ«æ±‚è§£ï¼Œå†æ±‚å’Œï¼Œå¾—åˆ°åŒæ ·çš„ç»“æœ
- èƒ½é‡å®ˆæ’ï¼šå‡ºå°„Radianceä¸ä¼šå¤§äºå…¥å°„Radiance

## é•œé¢åå°„ã€æ¼«åå°„ä¸æ¬¡è¡¨é¢æ•£å°„

é€šå¸¸æˆ‘ä»¬è®¤ä¸ºï¼Œå…‰çº¿å…¥å°„åˆ°ç‰©ä½“è¡¨é¢ï¼Œæœ‰ä¸€éƒ¨åˆ†ä¼šè¢«**ç›´æ¥åå°„**å‡ºå»ï¼Œå½¢æˆé•œé¢åå°„ï¼ˆSpecularï¼‰çš„å½¢å¼å‡ºå°„ï¼Œè¿™éƒ¨åˆ†å‡ºå°„èƒ½é‡é«˜åº¦é›†ä¸­åœ¨è¾ƒå°çš„èŒƒå›´å†…ï¼Œçœ‹ä¸Šå»å°±æ˜¯å¾ˆäº®çš„é«˜å…‰ã€‚å¦ä¸€éƒ¨åˆ†å…‰çº¿åˆ™æ˜¯å…ˆè¢«ç‰©ä½“è¡¨é¢**å¸æ”¶**ï¼Œåœ¨ç‰©ä½“å†…éƒ¨é€›ä¸€åœˆä¹‹åå†å‡ºå°„ï¼Œè¿™éƒ¨åˆ†çš„å‡ºå°„å…‰çº¿è¢«ç§°ä¸ºæ¬¡è¡¨é¢æ•£å°„ï¼ˆSubsurface Scatteringï¼‰ï¼Œä¹Ÿå«æ¼«åå°„ï¼ˆDiffuseï¼‰ã€‚æ¼«åå°„ä¼šæ¯”è¾ƒå‡åŒ€åœ°åˆ†å¸ƒåœ¨å„ä¸ªæ–¹å‘ä¸Šã€‚

![](https://pic4.zhimg.com/80/v2-979af8a7c805439024e3b25985095803_1440w.webp)

æ¼«åå°„å’Œæ¬¡è¡¨é¢æ•£å°„**åœ¨ç‰©ç†ä¸Šæ˜¯ä¸€å›äº‹**ï¼Œä¸è¿‡æˆ‘ä»¬é€šå¸¸è¯´çš„æ¼«åå°„æ˜¯è®¤ä¸ºå…‰çº¿å°±åœ¨åŒä¸€ä¸ªåƒç´ å¤„å‡ºå°„äº†ï¼Œè€Œæ¬¡è¡¨é¢æ•£å°„ä¼šè€ƒè™‘å…‰çº¿è¢«å¸æ”¶åè¿›å…¥ç‰©ä½“å†…éƒ¨å¹¶åœ¨å…¶ä»–åœ°æ–¹å‡ºå°„ï¼Œçœ‹ä¸Šå»æœ‰ä¸€ç§é€šé€çš„æ•ˆæœã€‚

Cook-Torrance BRDFåŒæ—¶åŒ…å«æ¼«åå°„ä¸é•œé¢åå°„ï¼Œç”±äºåŸºäºç‰©ç†çš„BRDFéƒ½æ˜¯çº¿æ€§çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†åå°„ç‡æ–¹ç¨‹æ‹†æˆäº’ç›¸ç‹¬ç«‹ä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«æ±‚è§£ï¼š

$\int  {\Omega}({f}_{diffuse}(x,w,w_{i)}+ f_{specular}(x,w,w_i))L_i(x,w_i)cos {(w_i,n)}dw_i$
æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹é•œé¢åå°„éƒ¨åˆ†ã€‚

### å¾®å¹³é¢æ¨¡å‹ä¸é•œé¢åå°„

æ‰€è°“å¾®å¹³é¢æ¨¡å‹ï¼Œå°±æ˜¯è®¤ä¸ºå¯¹ä»»æ„æè´¨çš„ç‰©ä½“è¡¨é¢ï¼Œå¯ä»¥è¿›ä¸€æ­¥ç»†åˆ†ä¸ºè®¸å¤šå°çš„ç†æƒ³é•œé¢ï¼Œè¿™äº›é•œé¢ä¼šå°†å…¥å°„å…‰çº¿æŒ‰ç…§æ³•çº¿-åå°„æ–¹å‘å®Œç¾åå°„ã€‚è¶Šå…‰æ»‘çš„å¹³é¢ï¼Œå°é•œé¢çš„æ’åˆ—è¶Šæ•´é½ï¼Œå‡ºå°„å…‰çº¿å°±ä¼šè¶Šé›†ä¸­ï¼Œåä¹‹ï¼Œå‡ºå°„å…‰çº¿åˆ™ä¼šè¶Šå‘æ•£ã€‚æ‰€æœ‰çš„PBRç®—æ³•ï¼Œéƒ½æ˜¯åŸºäºå¾®å¹³é¢æ¨¡å‹è¿›è¡Œæ¸²æŸ“çš„ã€‚

![](https://pic4.zhimg.com/80/v2-ce5f27af70574ddd9f2e587f5ec7df9b_1440w.webp)

ç”±äºæˆ‘ä»¬åœ¨æ¸²æŸ“ä¸­ï¼Œæ“ä½œçš„æœ€å°å•ä½æ˜¯åƒç´ ï¼Œå› æ­¤ï¼Œäººä»¬å®šä¹‰äº†ä¸€ä¸ª**ç²—ç³™åº¦ï¼ˆRoughnessï¼‰**çš„æ¦‚å¿µï¼Œç”¨æ¥è¡¨ç¤ºä¸€ä¸ªåƒç´ å†å¾€ä¸‹çš„å¾®è§‚å±‚é¢ä¸Šï¼Œé•œé¢æ’åˆ—çš„æ•´é½ç¨‹åº¦ã€‚ç²—ç³™åº¦æ˜¯ä¸€ä¸ª0~1çš„floatå€¼ï¼Œç²—ç³™åº¦è¶Šé«˜ï¼Œä»£è¡¨è¯¥åƒç´ çš„å‡ºå°„å…‰çº¿è¶Šå‘æ•£ï¼Œçœ‹ä¸Šå»è¶Šåƒæ¼«åå°„ï¼Œåä¹‹ï¼Œåˆ™ä»£è¡¨å‡ºå°„å…‰çº¿è¶Šé›†ä¸­äºæ³•çº¿-åå°„æ–¹å‘é™„è¿‘ï¼Œçœ‹ä¸Šå»è¶Šåƒç†æƒ³é•œé¢åå°„ã€‚
Cook-Torrance BRDFçš„é•œé¢åå°„éƒ¨åˆ†é•¿è¿™æ ·ï¼š

$f_{specular} = \frac{DFG} {4cos(w,n)cos(w_i,n)}$

**æ³•çº¿åˆ†å¸ƒå‡½æ•°Dï¼š**åƒç´ æ‰€åŒ…å«çš„å¾®å°é•œé¢ä¸­æœ‰ç™¾åˆ†ä¹‹å¤šå°‘æ³•çº¿ä¸åƒç´ æ³•çº¿ä¸€è‡´ï¼Œç²—ç³™åº¦è¶Šé«˜ï¼Œè¿™ä¸ªä¸€è‡´æ€§å°±ä¼šè¶Šä½ï¼ŒDå€¼è¶Šå°ã€‚

**å‡ ä½•é®è”½å‡½æ•°Gï¼š**åœ¨å¾®å¹³é¢æ¨¡å‹ä¸‹ï¼Œä¸€ä¸ªåƒç´ åŒ…å«çš„å¾®å°é•œé¢å¯èƒ½ä¼šäº’ç›¸é®æŒ¡ã€‚å‡ ä½•é®è”½å‡½æ•°æè¿°äº†å› ä¸ºå¾®å°é•œé¢äº’ç›¸é®æŒ¡è€Œé€ æˆå‡ºå°„å…‰çº¿è¡°å‡çš„ç¨‹åº¦ã€‚ç²—ç³™åº¦è¶Šé«˜ï¼Œé®è”½ç¨‹åº¦å°±ä¼šè¶Šé«˜ï¼ŒGå€¼è¶Šå°ã€‚

**è²æ¶…å°”æ–¹ç¨‹Fï¼š**è²æ¶…å°”æ–¹ç¨‹æè¿°äº†åå°„å…‰çº¿å æ‰€æœ‰å…‰çº¿çš„æ¯”ä¾‹ï¼Œè¯¥é¡¹ä¸ä»…ä¸æè´¨çš„åŸºç¡€åå°„ç‡æœ‰å…³ï¼Œè¿˜å–å†³äºå…‰çº¿ä¸åƒç´ æ³•çº¿çš„å¤¹è§’ã€‚åœ¨å…‰çº¿ä¸åƒç´ æ³•çº¿å‚ç›´çš„æƒ…å†µä¸‹ï¼ŒFå€¼è¾¾åˆ°æœ€å¤§å€¼ã€‚

#### è²æ¶…å°”é¡¹

è²æ¶…å°”æ–¹ç¨‹æœ¬èº«æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œå¤§å®¶å¹³æ—¶ä½¿ç”¨çš„é€šå¸¸æ˜¯Fresnel-Schlickçš„è¿‘ä¼¼æ–¹ç¨‹ï¼š

$F_{Schlick} = F_0+(1-F_0)(1-cos(h,v))^5$

å…¶ä¸­hå°±æ˜¯æˆ‘ä»¬åœ¨Blinn-Phongæ¨¡å‹é‡Œä½¿ç”¨çš„é‚£ä¸ªhalfå‘é‡ï¼ŒÂ â„=ğ‘£+ğ‘™Â ï¼Œvæ˜¯è§‚å¯Ÿæ–¹å‘ï¼Œlæ˜¯å…‰ç…§æ–¹å‘ã€‚è¿™ä¸ªå¼å­æ˜¯å¯¹çš„ï¼Œä½†ä»–çš„æœ¬æ¥é¢è²Œæ˜¯è¿™æ ·çš„

$F_{Schlick} = F_0+(F_{90}-F_0)(1-cos(h,v))^5$

ğ¹0Â æ˜¯æè´¨åœ¨å…‰çº¿ä»æ³•çº¿æ–¹å‘å…¥å°„æ—¶çš„åå°„ç‡ï¼Œå¯ä»¥é€šè¿‡æŸ¥è¡¨å¾—åˆ°ã€‚Â ğ¹90Â æ˜¯å…‰çº¿ä»å‚ç›´äºæ³•çº¿æ–¹å‘å…¥å°„æ—¶çš„åå°„ç‡ã€‚æˆ‘ä»¬é€šå¸¸ä¼šè®¤ä¸ºÂ ğ¹90=1Â ï¼Œä¸è¿‡Disneyä¹Ÿæœ‰ä¸€ä¸ªæ›´å‡†ç¡®çš„åšæ³•ï¼š

$F_{90} = 0.5+2*roughness*cos^2(h,v)$



### æ¼«åå°„

å› ä¸ºè²æ¶…å°”é¡¹ä»£è¡¨çš„æ„ä¹‰æ˜¯åå°„å…‰çº¿å å…¨éƒ¨å…‰çº¿çš„æ¯”ä¾‹ï¼Œé‚£ä¹ˆç®—å‡ºäº†è²æ¶…å°”é¡¹ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ç”¨èƒ½é‡å®ˆæ’ç®—å‡ºæ¼«åå°„éƒ¨åˆ†æ‰€å æ¯”ä¾‹
æ‰€ä»¥æ¼«åå°„éƒ¨åˆ†æ‰€å æ¯”ä¾‹åº”è¯¥æ˜¯ï¼ˆ1-Fï¼‰
æ‰€ä»¥å®Œæ•´çš„Cook-Torrance BRDFå¦‚ä¸‹

$f_{cook-torrance} = \frac {Albedo}{\pi}(1-F)+\frac {DFG}{4cos(w,n)cos(w_i,n)}$

###  é‡‘å±åº¦

æ ¹æ®Disneyçš„è§‚å¯Ÿç»“æœï¼Œé‡‘å±æè´¨åœ¨å…‰çº¿å…¥å°„å¸æ”¶åå°±ä¸ä¼šå‡ºå°„äº†**ï¼ˆæ²¡æœ‰æ¼«åå°„ï¼ï¼‰**ï¼Œå…¶æœ¬èº«çš„åŸºç¡€é¢œè‰²ä¼šåœ¨é•œé¢åå°„ä¸­æ˜¾ç°ã€‚éé‡‘å±æè´¨åˆ™æ˜¯é€šè¿‡æ¼«åå°„æ˜¾ç°å‡ºåŸºç¡€é¢œè‰²ï¼Œé•œé¢åå°„çš„æ˜¯å…‰æºé¢œè‰²ã€‚ä¸¥æ ¼æ¥è¯´è¿™ä¸¤ç§å…‰ç…§æ¨¡å‹æ˜¯ä¸ä¸€æ ·çš„ï¼Œä½†æ˜¯Disneyæå‡ºäº†ä¸€ä¸ªé‡‘å±åº¦ï¼ˆMetallic-nessï¼‰çš„æ¦‚å¿µï¼Œå·§å¦™åœ°å°†ä¸¤ç§å…‰ç…§æ¨¡å‹ç”¨åŒä¸€ä¸ªå¼å­è¡¨è¾¾å‡ºæ¥äº†ï¼š

- é‡‘å±æè´¨çš„é‡‘å±åº¦ä¸º1ï¼Œéé‡‘å±æè´¨é‡‘å±åº¦ä¸º0ï¼Œé‡‘å±åº¦åœ¨0~1ä¹‹é—´æ—¶ï¼Œæ„æ€æ˜¯è¯¥åƒç´ ä½ç½®åœ¨å¾®å¹³é¢å±‚é¢æ··æœ‰æ‚è´¨ï¼ˆæ¯”å¦‚é‡‘å±æ°§åŒ–ç­‰ç­‰ï¼‰ï¼Œæœ€ç»ˆç»“æœä¼šæ˜¯ä¸¤ç§æ¨¡å‹æŒ‰é‡‘å±åº¦è¿›è¡ŒBlendã€‚
- é‡‘å±æè´¨çš„æ¼«åå°„éƒ¨åˆ†åº”è¯¥ä¸º0
- é‡‘å±æè´¨çš„é•œé¢åå°„å¯¹äºä¸åŒæ³¢é•¿çš„å…‰å¸æ”¶ç¨‹åº¦ä¸ä¸€æ ·ï¼Œæ‰€ä»¥é‡‘å±æè´¨çš„Â ğ¹0Â å°±ç­‰äºå…¶Albedo
- éé‡‘å±æè´¨çš„Â ğ¹0Â éƒ½å¾ˆå°ï¼Œå¹¶ä¸”å¯¹äºRGBåˆ†é‡çš„åå°„æ²¡æœ‰å·®å¼‚ï¼Œå¯ä»¥ç»Ÿä¸€ç”¨0.04æ¥è¿‘ä¼¼ã€‚è¿™æ ·å¯ä»¥åœ¨Shaderä¸ŠæŠŠÂ ğ¹0Â å’ŒAlbedoç”¨ä¸€ä¸ªVectorè¡¨ç¤ºã€‚

ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºæœ€ç»ˆç‰ˆçš„Cook-Torrance BRDFå¦‚ä¸‹ï¼š

$F_{0}= lerp(0.04,Albedo,Metallic)$

$f_{cook-torrance} = \frac {Albedo}{\pi}(1-F)(1 - Metallic)+\frac {DFG}{4cos(w,n)cos(w_i,n)}$

## æ¼«åå°„å…¨å±€å…‰ç…§

$L_0(x,w)=L_e(x,w)+\int{\Omega}f_r(x,w,w_i)L_i(x,w_i)\cos(w_i,n)dw_i$ 

è¿™ä¸ªæ¸²æŸ“æ–¹ç¨‹ä¸­çš„$L_i(x,w_i)$å¯ä»¥æ˜¯ä»»ä½•å…‰æºï¼Œæ ¹æ®å…‰æºçš„ç±»å‹æˆ‘ä»¬å¯ä»¥å°†å…¶åˆ†ä¸º**ç›´æ¥å…‰æºï¼ˆDirect Lightï¼‰**å’Œ**é—´æ¥å…‰æºï¼ˆIndirect Lightï¼‰**

è¿™æ ·æˆ‘ä»¬å¯ä»¥ç»™å‡ºå…¨å±€å…‰ç…§ä¸å±€éƒ¨å…‰ç…§çš„å®šä¹‰ï¼š

- å±€éƒ¨å…‰ç…§ï¼ˆLocal illuminationï¼‰ï¼šç‰©ä½“ä»…å—ç›´æ¥å…‰æºå½±å“çš„å…‰ç…§æ¨¡å‹
- å…¨å±€å…‰ç…§ï¼ˆGlobal illuminationï¼‰ï¼šç‰©ä½“åŒæ—¶å—åˆ°ç›´æ¥å…‰æºå’Œæ¥è‡ªåœºæ™¯ä¸­å…¶ä»–ç‰©ä½“åå°„æ¥çš„é—´æ¥å…‰æºå½±å“çš„å…‰ç…§æ¨¡å‹
- å…‰æ …æ¸²æŸ“å°±æ˜¯ä¸€ç§å±€éƒ¨å…‰ç…§æ¨¡å‹ï¼Œåœ¨è¿›è¡Œå…‰ç…§ç€è‰²æ—¶ä»…ä¿ç•™äº†ç€è‰²ç‚¹å’Œç›´æ¥ å…‰æºçš„ä¿¡æ¯
- å…‰çº¿è¿½è¸ªåˆ™æ˜¯ä¸€ç§å…¨å±€å…‰ç…§æ¨¡å‹ï¼Œä¼šè€ƒè™‘å…‰çº¿åœ¨ç‰©ä½“ä¹‹é—´çš„å¼¹å°„

å…¨å±€å…‰ç…§ä¸å±€éƒ¨å…‰ç…§çš„åŒºåˆ«åœ¨äºæ˜¯å¦è€ƒè™‘é—´æ¥å…‰ç…§ï¼Œä½†æ˜¯åœ¨å…‰æ …æ¸²æŸ“ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¾ˆå¤šæ–¹æ³•æ¥â€œæ‰“è¡¥ä¸â€ï¼Œä¸ºå…‰ç…§ç€è‰²å¸¦å…¥é¢å¤–ä¿¡æ¯ï¼Œå®ç°éƒ¨åˆ†çš„å…¨å±€å…‰ç…§æ•ˆæœã€‚

### ç¯å¢ƒå…‰ç…§

å®é™…å¼€å‘ä¸­ï¼Œé€šå¸¸æ˜¯ä½¿ç”¨ä¸€å¼ **ç«‹æ–¹ä½“è´´å›¾ï¼ˆCubemapï¼‰**ï¼Œä¸€æ–¹é¢å®ç°Skyboxçš„æ•ˆæœï¼Œå¦ä¸€æ–¹é¢ä¹Ÿæ˜¯å°†Cubemapä¸Šæ¯ä¸€ä¸ªåƒç´ ä½œä¸ºä¸€ä¸ªå…‰æºï¼Œé¢œè‰²å€¼ä¸ºå…¶Radianceï¼Œå‘ç«‹æ–¹ä½“ä¸­å¿ƒä½ç½®æŠ•å°„å…‰ï¼ˆé»˜è®¤æ‰€æœ‰ç€è‰²ç‚¹éƒ½åœ¨ä¸­å¿ƒä½ç½®ï¼‰ã€‚è€Œè¿™å°±æ˜¯Image Based Lightingçš„å«ä¹‰â€”â€”å°†å›¾åƒçš„åƒç´ ä½œä¸ºå…‰æºå¯¹ç‰©ä½“è¿›è¡Œç…§æ˜ã€‚

æŒ‰ç…§æ­¤åŸç†ï¼Œå¦‚æœå¯¹äºæ¯ä¸ªç€è‰²ç‚¹ï¼Œæˆ‘ä»¬éå†æ•´ä¸ªCubemapçš„æ‰€æœ‰åƒç´ ç‚¹å…‰æºï¼Œæ±‚å‡ºæ¼«åå°„ç»“æœå¹¶æ±‚å’Œï¼Œä¸å°±å¯ä»¥è·å¾—æ­¤ç‚¹çš„æ¼«åå°„Irradianceäº†å—ã€‚è€Œä¸”æˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒÂ $\int {\Omega}L_i(x,w_i)cos(w_i,n)dw_i$Â è¿™ä¸ªå¼å­ï¼Œå½“é»˜è®¤xä¸ºåŸç‚¹æ—¶ï¼Œè®¡ç®—ç»“æœåªä¼šä¸æ³•çº¿æ–¹å‘æœ‰å…³ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€å¼ æ–°çš„Cubemapï¼Œä»¥åƒç´ uvä½ç½®ä½œä¸ºæ³•çº¿æ–¹å‘ï¼Œç¦»çº¿è®¡ç®—å¹¶ä¿å­˜Irradianceå€¼

### ç¯å¢ƒå…‰é®è”½

ç”¨IBLåšç¯å¢ƒå…‰ç…§æ˜¯é»˜è®¤æ‰€æœ‰ç€è‰²ç‚¹éƒ½å¤„åœ¨ä¸­å¿ƒä½ç½®çš„ï¼Œè¿™æ ·å³ä½¿ä¸€ä¸ªç‚¹å‘¨å›´å…¨è¢«æŒ¡ä½äº†ï¼Œä¾ç„¶ä¼šå—åˆ°å®Œå…¨çš„ç¯å¢ƒå…‰ç…§ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ï¼Œå› æ­¤å°±éœ€è¦åš**ç¯å¢ƒå…‰é®è”½ï¼ˆAmbient Occlusionï¼‰**ã€‚

AOçš„ç‰©ç†åŸç†å°±æ˜¯é˜´å½±ï¼Œé˜´å½±è¿™ä¸œè¥¿åœ¨å…‰æ …æ¸²æŸ“é‡Œä¸€ç›´éƒ½æ˜¯éå¸¸éº»çƒ¦çš„å­˜åœ¨ã€‚å¯¹äºç›´æ¥å…‰ç…§ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨Shadowmapï¼Œå› ä¸ºå…‰æºæ•°é‡æœ‰é™ï¼Œä½†ç®—ç¯å¢ƒå…‰ç…§çš„æ—¶å€™ï¼Œå¯¹æ¯ä¸ªåƒç´ å…‰æ¸²æŸ“ä¸€ä¸ªShadowmapæ˜¾ç„¶åœ¨æ€§èƒ½ä¸Šæ˜¯ä¸å¯æ¥å—çš„ï¼Œç›®å‰åªèƒ½ç”¨ä¸€äº›æ¯”è¾ƒé»‘ç§‘æŠ€çš„æ–¹æ³•å»è¿‘ä¼¼ã€‚è¿™äº›é»‘ç§‘æŠ€çš„ä»£è¡¨å°±æ˜¯**å±å¹•ç©ºé—´ç¯å¢ƒå…‰é®è”½ï¼ˆScreen Space Ambient Occlusionï¼ŒSSAOï¼‰**ã€‚

![](https://pic3.zhimg.com/80/v2-fcef7399e1dff085889249eab25cf9de_1440w.webp)

SSAOçš„å…·ä½“åšæ³•æ˜¯ï¼Œåœ¨æ·±åº¦å›¾ä¸Šé€åƒç´ è¿›è¡Œè®¡ç®—ï¼Œé€šè¿‡æ·±åº¦å€¼ï¼ŒUVåæ ‡å’ŒæŠ•å½±é€†çŸ©é˜µåæ¨å¾—åˆ°ä¸–ç•Œåæ ‡ï¼Œéšååœ¨è¯¥ç‚¹çš„å•ä½åŠçƒå†…éšæœºè¿›è¡Œé‡‡æ ·ã€‚è®¡ç®—é‡‡æ ·ç‚¹çš„æ·±åº¦å€¼ï¼Œä¸æ·±åº¦å›¾ä¸­å¯¹åº”ä½ç½®è¿›è¡Œæ¯”è¾ƒï¼Œåˆ¤æ–­æ˜¯å¦é®æŒ¡ï¼Œæœ€åä»¥è¢«é®æŒ¡æ•°é™¤ä»¥é‡‡æ ·æ€»æ•°ä½œä¸ºAOçš„å› å­ï¼Œä¹˜åœ¨ç¯å¢ƒå…‰é¡¹ä¸Šã€‚

è¿™ä¸ªç®—æ³•çœŸçš„å¾ˆç®€å•ï¼Œæ•ˆç‡ä¹Ÿå¿«ã€‚åé¢è¿˜å‡ºç°äº†åœ¨æ³•çº¿åŠçƒå†…é‡‡æ ·çš„æ”¹è¿›æ–¹æ³•ï¼Œå› ä¸ºå»¶è¿Ÿæ¸²æŸ“ä¸­æœ¬æ¥å°±æœ‰æ³•çº¿å›¾ï¼Œæ‰€ä»¥å‡ ä¹æ˜¯0 costï¼Œæ•ˆæœè¿˜æ›´å¥½ï¼Œå› æ­¤æˆäº†ç°åœ¨æ¸¸æˆçš„æ ‡é…ã€‚

SSç³»ç®—æ³•çš„éƒ½åŸºäºä¸€ä¸ªæ ¸å¿ƒæ€æƒ³ï¼šè¯»å–å…¨å±æ·±åº¦å›¾ï¼Œä¹Ÿå°±æ˜¯æ·±åº¦ç¼“å†²åŒºï¼Œç»“åˆæ‘„åƒæœºæ•°æ®ï¼Œå¯ä»¥è·å¾—ä¸€éƒ¨åˆ†çš„åœºæ™¯ç»“æ„æ•°æ®ï¼Œä»¥æ­¤åœ¨å±€éƒ¨å…‰ç…§ä¸­è¿‘ä¼¼è®¡ç®—ä¸€äº›å…¨å±€å…‰ç…§çš„æ•ˆæœã€‚æŠ€æœ¯ç»†èŠ‚æˆ‘ä»¬è¿˜æ˜¯ä¸å¤šè®²ï¼Œæ¥çœ‹çœ‹ä»æ·±åº¦åæ¨ä¸–ç•Œåæ ‡æ˜¯æ€ä¹ˆåšçš„ï¼š

1. $(u*2-1,v*2-1,z) = (x,y,z)_{ndc}$
2. $(x,y,z)_{ndc} =\frac {(x,y,z)_{clip}}{w_clip}$
3. $(x,y,z,1)_{world} * VP = (x,y,z,w)_{clip}$
4. $(x,y,z,1)_{world}  = VP^{-1}(x,y,z,1)_{ndc} * w_{clip}$
5. $(VP^{-1}*(x,y,z,1)_{ndc}) * w = w_{clip}$
6. ä»¤$C = VP^{-1}*(x,y,z,1)_{ndc}$
7. $(x,y,z)_{world} = \frac{C_{xyz}}{C_w}$

[ä»æ·±åº¦ç¼“å†²é‡å»ºä¸–ç•Œç©ºé—´ä½ç½®](https://zhuanlan.zhihu.com/p/92315967)

ä¹Ÿå°±æ˜¯åªéœ€è¦VPçŸ©é˜µçš„é€†çŸ©é˜µï¼Œæ·±åº¦å›¾uvåæ ‡ä»¥åŠæ·±åº¦å€¼ï¼Œå°±èƒ½åæ¨å›ä¸–ç•Œåæ ‡ã€‚

### Lightmap

Lightmapå°±æ˜¯æå‰é¢„çƒ˜ç„™å¥½çš„æ¯ä¸ªåƒç´ ç‚¹å¤„çš„Irradianceï¼Œå­˜å‚¨åœ¨ä¸€ä¸ªfloat3å€¼ä¸­

Lightmapçš„ä¼˜ç‚¹åœ¨äºæ¯”è¾ƒç›´è§‚å’Œç®€å•ï¼Œè¿è¡Œæ—¶åªéœ€è¦å¤šé‡‡æ ·ä¸€æ¬¡å°±èƒ½è·å¾—æ¼«åå°„å…¨å±€å…‰ç…§çš„æ•ˆæœï¼Œä½†ç¼ºç‚¹ä¹ŸåŒæ ·çªå‡ºï¼š

- Lightmapåªé€‚ç”¨äºé™æ€åœºæ™¯å’Œé™æ€ç¯å…‰ï¼ŒåŠ¨æ€ç‰©ä½“ä¸ä¹‹ä¸å¥½èåˆ
- Lightmapçƒ˜ç„™è€—æ—¶å¾ˆé•¿ï¼Œç¨å¾®ä¸€ç¼–è¾‘åœºæ™¯å’Œç¯å…‰å°±è¦ç­‰å¾ˆä¹…æ‰èƒ½çœ‹æ•ˆæœ
- Lightmapå ç”¨ç©ºé—´å¾ˆå¤§ï¼Œå› ä¸ºé™æ€åœºæ™¯çš„æ¯ä¸€ä¸ªä½ç½®éƒ½è¦åŒ…æ‹¬è¿›å»
- å¦‚æœé€‰æ‹©çœç©ºé—´è€Œä½¿ç”¨åˆ†è¾¨ç‡è¾ƒä½çš„Lightmapï¼Œåˆ™ä¼šæŸå¤±æœ€ç»ˆæ¸²æŸ“çš„æ•ˆæœ


### çƒè°å…‰ç…§

çƒè°å…‰ç…§çš„æ•°å­¦åŸç†æ¯”è¾ƒå¤šï¼Œè¿™é‡Œç®€å•æ‘˜æŠ„å¸¦è¿‡

> **çƒè°å…‰ç…§ï¼ˆSpherical Harmonic Lightingï¼‰**åˆ™æ˜¯ç”¨å¦ä¸€ç§æ€è·¯æ¥æ±‚è§£çš„å…¨å±€å…‰ç…§ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯ä½¿ç”¨çƒè°åŸºå‡½æ•°æ¥è¿‘ä¼¼è¡¨ç¤ºå…‰æºå‡½æ•°ï¼Œç®€åŒ–è®¡ç®—ã€‚
> Unityè¿™ä¸ªçƒè°å…‰ç…§çš„åŸç†æ˜¯ï¼Œå°†æŸä¸€ç‚¹å¤„çš„Irradianceä¸æ³•çº¿(x,y,z)çš„å‡½æ•°å…³ç³»ç”¨çƒè°åŸºå‡½æ•°è¿›è¡Œè¡¨ç¤ºã€‚è¿è¡Œæ—¶ä»£å…¥æ³•çº¿æ–¹å‘ï¼Œå¯å¿«é€Ÿæ±‚è§£Irradianceï¼Œè·å–æ¼«åå°„å…¨å±€å…‰ç…§çš„æ•ˆæœã€‚

### é¢„è®¡ç®—è¾å°„äº®åº¦ä¼ è¾“

æ•°å­¦åŸç†æ¯”è¾ƒå¤šï¼Œéš¾ç†è§£

> **é¢„è®¡ç®—è¾å°„äº®åº¦ä¼ è¾“ï¼ˆPrecomputed**Â **Radiance Transferï¼ŒPRTï¼‰**æ˜¯çƒè°å…‰ç…§çš„è¿›ä¸€æ­¥å‘å±•ï¼Œä¸»è¦æ˜¯ä¸ºçƒè°å…‰ç…§è€ƒè™‘äº†é˜´å½±ä¸è‡ªé˜´å½±ã€‚å‡†ç¡®çš„è¯´ï¼ŒPRTåº”è¯¥æ˜¯ç”¨æ¥åšAOçš„ã€‚å› ä¸ºåƒUnityé‚£æ ·åœ¨Probeå¤„æ‹Cubemapå†è®¡ç®—Irradianceè¿™ç§åšæ³•ï¼Œæœ¬èº«å°±å·²ç»è€ƒè™‘äº†ç‰©ä½“é—´çš„é®è”½äº†ã€‚åªæœ‰å¯¹äºç”¨IBLåšçš„ç¯å¢ƒå…‰ç…§ï¼Œæˆ‘ä»¬æ‰éœ€è¦åšé¢å¤–çš„å¯è§æ€§è®¡ç®—ï¼Œä¹Ÿå°±æ˜¯åœ¨åå°„ç‡æ–¹ç¨‹ä¸­åŠ ä¸Šä¸€é¡¹Vï¼š
> 
> $L_0(x,w)=L_e(x,w)+\int{\Omega}f_r(x,w,w_i)V(x,w_i)L_i(x,w_i)\cos(w_i,n)dw_i$ 
> ![Alt Text](Textures/20240503201830.png)

## ä»Unity PBRæ¥ç†è§£PBR

åŸç†å½’åŸç†ï¼Œä»Unityè§’åº¦å¿«é€Ÿè¿‡ä¸€éä¸Šè¿°çš„æ¦‚å¿µï¼Œåœ¨å®é™…ç¼–å†™PBRä¸­æ˜¯ä»€ä¹ˆæƒ…å†µï¼Ÿï¼ˆå‰å‘ï¼‰

$FinalColor = GiColor + MainLightColor$

$GiColor =  (indirectDiffuse * diffuse + indirectSpecular )* min(SSAO,BakeAO)$

$MainLightColor = radiance * (diffuse + GGXspecular)$

å¤§è‡´å¦‚ä¸Š









